<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Board">
	
	<resultMap type="Board" id="boardMap">
		<result column="pk" property="pk"/>
		<result column="title" property="title"/>
		<result column="description" property="description"/>
		<result column="image" property="image"/>
		<result column="good" property="good"/>
		<result column="bad" property="bad"/>
		<result column="hit" property="hit"/>
		<result column="member_pk" property="member_pk"/>
		<result column="create_date" property="create_date"/>		
	</resultMap>
	
	
	<insert id="insertBoard" parameterType="Board">
		insert into 
		board_${category}
		(pk, title, description, create_date, category) 
		 values(board_seq.nextval, #{title}, #{description}, sysdate, #{category})	
	</insert>	
	
	<insert id="tagInsert" parameterType="com.model.Tag">
		insert into tags values (#{board_pk}, #{member_pk}, #{name}, #{category})
	</insert>
	
	<select  id="BoardPkOfTag" parameterType="map" resultMap="boardMap">		
		<![CDATA[
		select * from
		(select rownum rnum,pk,title,description,image,good,bad,hit,create_date from
		(select * from board_cafe where pk in 
		(select board_pk from tags where name in]]> 
		<foreach item="item" index="index" collection="tags"
      		open="(" separator="," close=")">
       			#{item}
  		</foreach>
  		<![CDATA[
  		) order by create_date desc))
		where rnum >= ((#{page}-1)*10+1) and rnum <= (#{page}*10)
		]]>	 
	</select>	
	
	
	
	<select id="getBoardPk" resultType="Integer">
		select board_seq.currval from dual
	</select>
	
	<select id="boardList"  parameterType="map"  resultMap="boardMap">
	    <![CDATA[
		select * from
		(select rownum rnum,pk,title,description,image,good,bad,hit,create_date from
		(select * from board_${category} order by create_date desc))
		where rnum >= ((#{page}-1)*10+1) and rnum <= (#{page}*10)
		]]>	 	
	</select>
	
	<select id="getTagList" resultType="string">
	 	select distinct name from tags where category=#{category}
	</select>
	
	<select id="getBoard" resultMap="boardMap" parameterType="map">
		select * from board_${category} where pk=#{id}
	</select>	
	
	
	
</mapper>